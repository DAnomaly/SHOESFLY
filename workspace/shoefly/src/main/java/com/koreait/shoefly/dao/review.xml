<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.koreait.shoefly.dao.ReviewDAO">

	<select id="countReview" resultType="int" parameterType="java.util.Map">
		SELECT COUNT(*) 
		  FROM Review
	   <where>
	   <if test="column != null || query != null">
		          		${column} LIKE '%' || #{query} || '%'
	   </if>
	   </where>
	</select>
	
	
	<select id="selectListReview" resultType="com.koreait.shoefly.dto.Review" parameterType="java.util.Map">
		SELECT B.REVIEW_NO AS REVIEWNO, B.MEMBER_ID AS MEMBERID, B.TITLE,
		       B.PRODUCT_NAME AS PRODUCTNAME, B.HIT, B.POSTDATE, B.STATE
		  FROM (SELECT ROWNUM AS RN, A.REVIEW_NO, A.MEMBER_ID,
		               A.TITLE, A.PRODUCT_NAME, A.HIT, A.POSTDATE, A.STATE
		          FROM (SELECT REVIEW_NO,
		                       MEMBER_ID,
		                       TITLE,
		                       PRODUCT_NAME,
		                       HIT,
		                       POSTDATE,
		                       STATE
		                  FROM REVIEW
		          <where>
		          	<if test="column != null || query != null">
		          		${column} LIKE '%' || #{query} || '%'
		          	</if>
		          </where>
		                 ORDER BY REVIEW_NO DESC) A) B
		 WHERE B.RN BETWEEN #{beginRecord} AND #{endRecord}
	</select>
	
	<select id="selectProduct" resultType="com.koreait.shoefly.dto.Review">
		SELECT PRODUCT_NAME AS PRODUCTNAME
		  FROM PRODUCT
		 ORDER BY PRODUCT_NAME
	</select>
	
	<insert id="insertReview">
		INSERT
  		INTO REVIEW
		VALUES (REVIEW_SEQ.NEXTVAL, #{param1}, #{param2}, #{param3}, #{param4}, #{param5}, SYSDATE, SYSDATE, 0, '127.0.0.1', 0)
	</insert>
	
	<select id="selectReview" resultType="com.koreait.shoefly.dto.Review">
		SELECT REVIEW_NO AS REVIEWNO, MEMBER_ID AS MEMBERID, PRODUCT_NAME AS PRODUCTNAME, TITLE, CONTENT, IMAGE, POSTDATE, MODIFYDATE, HIT, IP, STATE
		  FROM REVIEW
		 WHERE REVIEW_NO = #{reviewNo} 
	</select>

</mapper>